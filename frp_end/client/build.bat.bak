@echo off
rem 设置窗口标题
title FRP客户端打包工具

echo.
echo ==========================================================
echo.
echo           FRP高级客户端 - 最终打包与清理脚本
echo.
echo ==========================================================
echo.

rem 定义一些变量，方便修改
set EXE_NAME="萌！FRP高级客户端"
set ICON_FILE="app.ico"
set DLL_FILE="MoeFrpClient.mfc"
set MAIN_SCRIPT="main.py"
set WINDOWS_ICON_FILE="windows.ico"
set VERSION_FILE="version.txt"

rem 检查必要文件是否存在
if not exist %ICON_FILE% (
    echo [错误] 找不到图标文件: %ICON_FILE%
    goto end
)
if not exist %DLL_FILE% (
    echo [错误] 找不到核心DLL文件: %DLL_FILE%
    goto end
)
if not exist %MAIN_SCRIPT% (
    echo [错误] 找不到主脚本文件: %MAIN_SCRIPT%
    goto end
)
if not exist %WINDOWS_ICON_FILE% (
    echo [错误] 找不到窗口图标文件: %WINDOWS_ICON_FILE%
    goto end
)
if not exist %VERSION_FILE% (echo [错误] 找不到版本信息文件: %VERSION_FILE% & goto end)

echo [步骤 1/3] 开始使用 PyInstaller 进行打包...
echo.

rem 执行PyInstaller命令
pyinstaller --clean --noconsole --onefile ^
    --name=%EXE_NAME% ^
    --icon=%ICON_FILE% ^
    --add-binary=%DLL_FILE%;. ^
    --add-data=%WINDOWS_ICON_FILE%;. ^
    --version-file %VERSION_FILE% ^
    %MAIN_SCRIPT%

rem 检查打包是否成功
if %errorlevel% neq 0 (
    echo.
    echo [错误] PyInstaller 打包失败！请检查上面的错误信息。
    goto end
)

echo.
echo [步骤 2/3] 打包成功！开始清理临时文件...
echo.

rem 删除PyInstaller生成的 .spec 文件
if exist %EXE_NAME%.spec (
    echo  - 正在删除 %EXE_NAME%.spec...
    del %EXE_NAME%.spec
)

rem 删除PyInstaller生成的 build 文件夹
if exist build (
    echo  - 正在删除 build 文件夹...
    rmdir /s /q build
)

echo.
echo [步骤 3/3] 清理完成！
echo.
echo ==========================================================
echo.
echo           ? 打包成功！?
echo.
echo           最终的EXE文件位于 `dist` 文件夹中。
echo.
echo ==========================================================
echo.

:end
rem pyinstaller --clean --noconsole --onefile --name="萌！FRP高级客户端" --icon="app.ico" --add-binary="MoeFrpClient.mfc";. --add-data="windows.ico";. --version-file "version.txt" --exclude-module unittest --exclude-module tkinter "main.py"
rem 暂停，方便查看日志
pause