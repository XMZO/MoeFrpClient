[English](./README.md) | [中文](./README_zh.md)
 
# Moe! FRP Client
 
Moe! FRP is a feature-rich, security-focused, and user-friendly solution for managing FRP (Fast Reverse Proxy). It consists of a lightweight **Flask** backend server and a powerful **PySide6** graphical desktop client, designed to provide users with a convenient, synchronizable, and shareable service for managing their reverse proxy configurations.
 
[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![Flask](https://img.shields.io/badge/Flask-3.0-black.svg)](https://flask.palletsprojects.com/)
[![PySide6](https://img.shields.io/badge/PySide6-6.9-brightgreen.svg)](https://www.qt.io/qt-for-python)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

> **Note**: Some parts of this project were developed with the assistance of Google's Gemini 2.5 Pro.
 
---
 
## ✨ Core Features
 
*   **☁️ Cloud Sync & Profile Management**:
    *   User profiles (nodes, proxy rules) are securely stored on the cloud server.
    *   Supports creating and managing multiple independent configuration profiles.
    *   Includes a "Guest Mode" for local, temporary configurations without logging in.
 
*   **🤝 Powerful Share & Subscription System**:
    *   Users can create shareable links from their own configurations.
    *   Supports **Full Mode** (subscribers use a fixed configuration) and **Template Mode** (subscribers can customize parameters like local ports).
    *   Sharers can manage or revoke their shares at any time.
 
*   **🔐 Security-Focused Design**:
    *   **Invite-Only Registration**: Controls user access; registration requires a valid invitation code.
    *   **Enhanced Login Verification**: Implements a robust **Challenge-Response** mechanism. The login proof is generated by combining a `version_secret` + `core_component_hash` + `client_version` + `challenge`, ensuring that only specific, official client versions can log in.
    *   **Anti-Brute-Force Measures**: The client features a **Hardened Security Delay** dialog during login/registration, which runs a computationally expensive Argon2 hash in a background thread to effectively slow down automated attacks.
    *   **Strong Password Hashing**: The server uses the **Argon2** algorithm to securely store user passwords.
    *   **Local Credential Encryption**: The client uses the native system **keyring** combined with a **unique machine GUID** to securely store "Remember Me" credentials, binding them to the specific device.
    *   **Server-Side Rate Limiting**: Uses Flask-Limiter to protect critical APIs from abuse.
 
*   **👑 Admin Privileges**:
    *   A built-in `admin` role is required for high-privilege APIs (e.g., resetting a user's password), ensuring the security of advanced operations.
 
*   **🖥️ Rich Graphical Client**:
    *   Built with PySide6 (Qt for Python) for a beautiful and intuitive interface.
    *   **Isolated FRP Core**: The FRP core (`MoeFrpClient.mfc`) runs in a separate subprocess, fully isolated from the main GUI to ensure stability.
    *   Visual CRUD (Create, Read, Update, Delete) operations for server nodes and proxy rules.
    *   **Fun Image Viewer**:
        *   Fetches images from multiple API sources using **weighted randomization**.
        *   Supports **animated GIF** playback.
        *   A full-featured viewer with **mouse panning**, **scroll-wheel zooming**, and a **right-click "Save As..."** context menu.
 
*   **🔧 Convenient Server Management**:
    *   Includes a powerful command-line management tool (`generate_invite_code.py`).
    *   Supports both interactive menu and command-line arguments for easy management of users, invitation codes, and password resets.
 
## 📁 Project Structure
 
```
frp_end/
├── client/                      # Client-side application
│   ├── api/                     # Modular API client library
│   │   ├── __init__.py          # Assembles ApiClient, exposes module interfaces
│   │   ├── auth.py              # Handles user authentication, registration, session
│   │   ├── base.py              # Wraps low-level requests, handles errors
│   │   ├── config.py            # Handles cloud configuration synchronization
│   │   └── share.py             # Handles sharing and subscription APIs
│   ├── app.ico                  # General application icon
│   ├── windows.ico              # Main window icon for PySide6
│   ├── config.py                # Static client configuration (server URL, version)
│   ├── Dialogs.py               # All UI dialogs (Login, Edit, Image Viewer, etc.)
│   ├── frpc_runner.py           # Subprocess runner for the frpc core service
│   ├── ImageLabel.py            # Custom image display widget
│   ├── main.py                  # Main entry point for the client application
│   ├── MoeFrpClient.mfc         # (Must be provided) FRP core dynamic link library
│   ├── requirements.txt         # Python dependencies for the client
│   ├── security.py              # Encryption Manager (secure local credential storage)
│   ├── threads.py               # Background threads (Ping, LogReader, ImageFetcher)
│   ├── utils.py                 # Utility functions (resource path, hashes)
│   └── proxy.py
│
└── server/                      # Server-side application
    ├── generate_invite_code.py  # Core server management script
    ├── requirements.txt         # Python dependencies for the server
    ├── server.py                # Main Flask backend application
    ├── users.db                 # (Auto-generated) SQLite database file
    └── server.log               # (Auto-generated) Server log file
```
 
## 🛠️ Tech Stack
 
*   **Backend (Server)**:
    *   Framework: **Flask**
    *   Database: **SQLite**
    *   Password Hashing: **Argon2**
    *   Rate Limiting: **Flask-Limiter**
 
*   **Frontend (Client)**:
    *   GUI Framework: **PySide6 (Qt6)**
    *   Local Encryption: **Cryptography**, **Keyring**, **Machine GUID**
    *   Configuration Format: **TOML**
    *   HTTP Communication: **Requests**
    *   Core Loading: **ctypes**
 
## 🚀 Installation & Deployment
 
### 1. Server
 
The server handles user authentication and configuration storage.
 
```bash
# 1. Navigate to the server directory
cd frp_end/server
 
# 2. (Recommended) Create and activate a Python virtual environment
python -m venv venv
source venv/bin/activate  # on Windows: venv\Scripts\activate
 
# 3. Install dependencies
pip install -r requirements.txt
 
# 4. Run the server
# The users.db file will be created automatically on the first run.
python server.py
# The server will run on http://127.0.0.1:5000 by default.
```
 
### 2. Client
 
The client is the graphical interface for users.
 
```bash
# 1. Navigate to the client directory
cd frp_end/client
 
# 2. (Recommended) Create and activate a Python virtual environment
python -m venv venv
source venv/bin/activate # on Windows: venv\Scripts\activate
 
# 3. Install dependencies
pip install -r requirements.txt
 
# 4. (Important!) Place the Core Component
# Rename your frpc core dynamic link library to `MoeFrpClient.mfc` and place it in this directory.
# The client cannot start connections without this file.
 
# 5. Run the client
python main.py
```
 
## 👑 Admin Setup (Important)
 
Certain advanced features (like resetting a user's password) require **administrator (`admin`)** privileges. The `admin` role is not assigned automatically and must be set manually by a database administrator for maximum security.
 
Follow these steps to set up your first admin account:
 
1.  **Register a Normal Account**:
    First, use the client's registration feature to create a standard account that you intend to use as an administrator (e.g., nickname `myadmin`).
 
2.  **Locate the Database**:
    Find the `users.db` file in the `server/` directory.
 
3.  **Elevate Privileges**:
    Open `users.db` with any SQLite database tool (like [DB Browser for SQLite](https://sqlitebrowser.org/)). Then, execute the following SQL command:
 
    ```sql
    UPDATE users SET role = 'admin' WHERE nickname = 'your_admin_nickname';
    ```
    For example, to promote the user `myadmin`:
    ```sql
    UPDATE users SET role = 'admin' WHERE nickname = 'myadmin';
    ```
    After saving the changes, this user will have admin privileges.
 
## 📖 Usage Guide
 
### Server Management (`generate_invite_code.py`)
 
This is the core administrative tool for the backend, supporting both interactive and command-line modes.
 
**Interactive Mode (Recommended):**
 
```bash
cd frp_end/server
python generate_invite_code.py
```
 
You will see a menu with the following options:
*   **1. View Invitation Code Status**: Display all codes (used/unused) and user information.
*   **2. Generate Invitation Codes**: Create one or more new codes.
*   **3. Delete Invitation Codes**: Delete specific codes or all unused codes.
*   **4. Delete User**: Delete a specified user and all their data.
*   **5. Reset User Password**: Generate a one-time password reset token for a user. **This requires you to enter your admin password.**
*   **6. Exit**
 
**Command-Line Mode:**
 
*   **Generate codes**: `python generate_invite_code.py -g 5` (generates 5)
*   **Check status**: `python generate_invite_code.py -s`
*   **Delete a user**: `python generate_invite_code.py -du <nickname>`
*   **Delete a code**: `python generate_invite_code.py -dc <invitation_code>`
*   **Reset password (Admin required)**: `python generate_invite_code.py -rp <nickname>`
 
### Client Workflow
 
1.  **Register & Login**:
    *   For first-time use, request an **invitation code** from an administrator to register.
    *   Log in with your registered nickname and password. You can check "Remember Me" to securely save credentials locally.
    *   Admin and regular user accounts use the same login window.
 
2.  **Profile Management**:
    *   **Guest Mode**: Used when not logged in. Configurations are local and may be lost when the application closes.
    *   **Cloud Profiles**: After logging in, you can create, delete, and edit your cloud-based profiles. All changes can be synced by clicking the "Save to Cloud" button.
 
3.  **Nodes & Proxies**:
    *   Within a selected profile, you can add, edit, and delete **server nodes** (your frps server information).
    *   You can also add, edit, and delete **proxy rules** (e.g., `tcp`, `http`).
 
4.  **Subscribe to Shares**:
    *   Click "Add Subscription" and enter a Share ID received from another user.
    *   If it's a **Template Share**, you can customize parameters like the local port.
    *   If it's a **Full Share**, you will use the exact configuration preset by the sharer.
 
5.  **Start Connection**:
    *   In the "Control & Logs" area, select an **Active Node** from the dropdown menu.
    *   Click the "Start Connection" button. Connection logs will be displayed in real-time in the text box below.